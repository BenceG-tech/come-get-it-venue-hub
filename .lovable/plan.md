
# Terv: Loyalty Milestone System & Revenue Attribution

## ProblÃ©ma Ã–sszefoglalÃ³

A jelenlegi rendszer hiÃ¡nyossÃ¡gai:
1. **Nem lÃ¡tszik tisztÃ¡n** a free drink bevÃ¡ltÃ¡s â†’ tÃ¶bbletkÃ¶ltÃ©s kapcsolat
2. **Nincs helyszÃ­n-specifikus lÃ¡togatÃ¡s szÃ¡mlÃ¡lÃ³** (3. alkalom ezen a hÃ©ten, 10. ebben a hÃ³napban)
3. **Nincs automatikus lojalitÃ¡s mÃ©rfÃ¶ldkÅ‘ detektÃ¡lÃ¡s** admin Ã©rtesÃ­tÃ©sekkel
4. **Nincs lÃ¡thatÃ³ ROI** per user per venue

---

## 1. RÃ‰SZ: Revenue Attribution Panel (BevÃ©tel AttribÃºciÃ³)

### 1.1 Ãšj "Revenue Impact" KÃ¡rtya a UserDetail oldalon

VilÃ¡gosan mutatja: **"Mit generÃ¡lt ez a felhasznÃ¡lÃ³?"**

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ’° BEVÃ‰TEL HATÃS - Kiss PÃ©ter                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚  ğŸ INGYEN ITALOK       â”‚  â”‚  ğŸ’³ TÃ–BBLETKÃ–LTÃ‰S       â”‚                  â”‚
â”‚  â”‚     12 db               â”‚  â”‚     48.500 Ft           â”‚                  â”‚
â”‚  â”‚     18.000 Ft Ã©rtÃ©k     â”‚  â”‚     (+2.7x ROI)         â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                                                             â”‚
â”‚  ğŸ“Š HELYSZÃNENKÃ‰NTI BREAKDOWN:                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Vinozza                                                              â”‚  â”‚
â”‚  â”‚  â”œâ”€ ğŸº 8 free drink (12.000 Ft)                                      â”‚  â”‚
â”‚  â”‚  â”œâ”€ ğŸ’³ 28.500 Ft vÃ¡sÃ¡rlÃ¡s                                            â”‚  â”‚
â”‚  â”‚  â””â”€ ğŸ“ˆ ROI: 2.4x                                                     â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚  BuBu                                                                 â”‚  â”‚
â”‚  â”‚  â”œâ”€ ğŸº 4 free drink (6.000 Ft)                                       â”‚  â”‚
â”‚  â”‚  â”œâ”€ ğŸ’³ 20.000 Ft vÃ¡sÃ¡rlÃ¡s                                            â”‚  â”‚
â”‚  â”‚  â””â”€ ğŸ“ˆ ROI: 3.3x                                                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Adatok forrÃ¡sa**: `pos_transactions` tÃ¡bla (mÃ¡r lÃ©tezik!) + `redemptions` tÃ¡bla Ã¶sszekÃ¶tÃ©se

---

## 2. RÃ‰SZ: Venue Loyalty Tracker (HelyszÃ­n LojalitÃ¡s KÃ¶vetÅ‘)

### 2.1 LÃ¡togatÃ¡s SzÃ¡mlÃ¡lÃ³k - IdÅ‘szak AlapÃº

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ† LOJALITÃS MÃ‰RFÃ–LDKÃ–VEK - Vinozza                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  ğŸ“… JELENLEGI ÃLLAPOT:                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ ğŸ—“ï¸ MA       â”‚  â”‚ ğŸ“† HETI     â”‚  â”‚ ğŸ“… HAVI     â”‚  â”‚ ğŸ›ï¸ Ã–SSZES   â”‚        â”‚
â”‚  â”‚   2. alkalomâ”‚  â”‚   5. alkalomâ”‚  â”‚  12. alkalomâ”‚  â”‚  67. alkalomâ”‚        â”‚
â”‚  â”‚   â–² streak! â”‚  â”‚   ğŸ”¥ rekord â”‚  â”‚   ğŸ“ˆ +3 vs  â”‚  â”‚  ğŸ† Top 5%  â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                                             â”‚
â”‚  ğŸ¯ KÃ–VETKEZÅ MÃ‰RFÃ–LDKÅ:                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  "ğŸ¥‡ Heti VIP" - MÃ©g 2 lÃ¡togatÃ¡s ezen a hÃ©ten                        â”‚  â”‚
â”‚  â”‚  Jutalom: +50 bÃ³nusz pont                                             â”‚  â”‚
â”‚  â”‚  [ğŸ“¢ Ã‰rtesÃ­tÃ©s kÃ¼ldÃ©se felhasznÃ¡lÃ³nak]                                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 LojalitÃ¡s MÃ©rfÃ¶ldkÅ‘ DefinÃ­ciÃ³k

| MÃ©rfÃ¶ldkÅ‘ | FeltÃ©tel | Jutalom Javaslat | Admin Ã‰rtesÃ­tÃ©s |
|-----------|----------|------------------|-----------------|
| **ElsÅ‘ LÃ¡togatÃ³** | 1. bevÃ¡ltÃ¡s helyszÃ­nen | Welcome drink | Nem |
| **VisszatÃ©rÅ‘** | 3. lÃ¡togatÃ¡s Ã¶sszesen | 10% kedvezmÃ©ny | Nem |
| **Heti TÃ¶rzsvendÃ©g** | 3+ lÃ¡togatÃ¡s / hÃ©t | BÃ³nusz pont | Igen |
| **Havi VIP** | 10+ lÃ¡togatÃ¡s / hÃ³nap | Ingyen desszert | Igen |
| **Platina Tag** | 50+ lÃ¡togatÃ¡s Ã¶sszesen | VIP kÃ¡rtya | Igen |
| **LegendÃ¡s** | 100+ lÃ¡togatÃ¡s Ã¶sszesen | ExkluzÃ­v ajÃ¡nlatok | Igen |

---

## 3. RÃ‰SZ: Admin Loyalty Alerts (Admin LojalitÃ¡s Ã‰rtesÃ­tÃ©sek)

### 3.1 Ãšj Ã‰rtesÃ­tÃ©si Rendszer

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ”” LOJALITÃS Ã‰RTESÃTÃ‰SEK                                  [BeÃ¡llÃ­tÃ¡sok âš™ï¸] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  ğŸ†• ÃšJ MÃ‰RFÃ–LDKÃ–VEK (ma):                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ğŸ† Kiss PÃ©ter elÃ©rte a "Heti VIP" stÃ¡tuszt @ Vinozza                 â”‚  â”‚
â”‚  â”‚    5. lÃ¡togatÃ¡s ezen a hÃ©ten | 28.500 Ft kÃ¶ltÃ©s                      â”‚  â”‚
â”‚  â”‚    [ğŸ Jutalom kÃ¼ldÃ©se] [ğŸ‘¤ Profil] [âœ–ï¸ ElutasÃ­tÃ¡s]                   â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ ğŸ‰ Nagy Anna elÃ©rte a "Havi VIP" @ BuBu                              â”‚  â”‚
â”‚  â”‚    10. lÃ¡togatÃ¡s ebben a hÃ³napban | 45.000 Ft kÃ¶ltÃ©s                 â”‚  â”‚
â”‚  â”‚    [ğŸ Jutalom kÃ¼ldÃ©se] [ğŸ‘¤ Profil] [âœ–ï¸ ElutasÃ­tÃ¡s]                   â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ â­ SzabÃ³ BÃ©la elÃ©rte a "Platina" @ A KERT BisztrÃ³                    â”‚  â”‚
â”‚  â”‚    50. lÃ¡togatÃ¡s Ã¶sszesen! | LTV: 185.000 Ft                         â”‚  â”‚
â”‚  â”‚    [ğŸ VIP kÃ¡rtya kÃ¼ldÃ©se] [ğŸ‘¤ Profil]                               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â”‚  ğŸ“Š MAI Ã–SSZESÃTÃ‰S:                                                         â”‚
â”‚  â€¢ 12 Ãºj "VisszatÃ©rÅ‘" (3. lÃ¡togatÃ¡s)                                       â”‚
â”‚  â€¢ 3 Ãºj "Heti VIP"                                                          â”‚
â”‚  â€¢ 1 Ãºj "Platina" ğŸ‰                                                        â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 Quick Action - Jutalom KÃ¼ldÃ©se

Amikor az admin rÃ¡kattint a "Jutalom kÃ¼ldÃ©se" gombra:

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ JUTALOM KÃœLDÃ‰SE - Kiss PÃ©ter                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                           â”‚
â”‚  MÃ©rfÃ¶ldkÅ‘: Heti VIP @ Vinozza (5. lÃ¡togatÃ¡s)            â”‚
â”‚                                                           â”‚
â”‚  VÃ¡lassz jutalmat:                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ â—‹ ğŸº Ingyen ital (kÃ¶vetkezÅ‘ lÃ¡togatÃ¡skor)       â”‚     â”‚
â”‚  â”‚ â—‹ ğŸ° Ingyen desszert                            â”‚     â”‚
â”‚  â”‚ â—‹ ğŸ’° 50 bÃ³nusz pont                             â”‚     â”‚
â”‚  â”‚ â—‹ ğŸ« 10% kedvezmÃ©ny kupon                       â”‚     â”‚
â”‚  â”‚ â—‹ âœï¸ EgyÃ©ni jutalom...                          â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                           â”‚
â”‚  Ãœzenet (opcionÃ¡lis):                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ KÃ¶szÃ¶njÃ¼k a hÅ±sÃ©gedet! ğŸ‰                       â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                           â”‚
â”‚  [âŒ MÃ©gse]                      [ğŸ“¤ KÃ¼ldÃ©s push-ban]    â”‚
â”‚                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. RÃ‰SZ: Enhanced Redemption Card (BÅ‘vÃ­tett BevÃ¡ltÃ¡s KÃ¡rtya)

### 4.1 BevÃ¡ltÃ¡s + KÃ¶ltÃ©s EgyÃ¼tt LÃ¡thatÃ³

A jelenlegi bevÃ¡ltÃ¡s lista helyett egy informatÃ­vabb kÃ¡rtya:

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸº BEVÃLTÃS #47 - Vinozza | 2024.01.15 18:45                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  FREE DRINK                          KAPCSOLÃ“DÃ“ KÃ–LTÃ‰S                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ ğŸ» Peroni (1500 Ft)â”‚      +       â”‚ ğŸ’³ POS tranzakciÃ³: 8.500 Ft   â”‚    â”‚
â”‚  â”‚ BevÃ¡ltva: 18:45    â”‚              â”‚ â€¢ 2x Hamburger (4.000 Ft)      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚ â€¢ 1x SÃ¼lt krumpli (1.500 Ft)   â”‚    â”‚
â”‚                                      â”‚ â€¢ 1x Peroni (2.000 Ft)         â”‚    â”‚
â”‚  ğŸ“Š KONTEXTUS:                       â”‚ â€¢ BorravalÃ³ (1.000 Ft)         â”‚    â”‚
â”‚  â€¢ 3. alkalom ezen a hÃ©ten           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚  â€¢ 8. alkalom ebben a hÃ³napban                                              â”‚
â”‚  â€¢ 45. Ã¶sszesen @ Vinozza            ROI: 5.7x (8500/1500)                  â”‚
â”‚                                                                             â”‚
â”‚  â±ï¸ TARTÃ“ZKODÃS: 1 Ã³ra 23 perc                                              â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. RÃ‰SZ: Technikai ImplementÃ¡ciÃ³

### 5.1 AdatbÃ¡zis BÅ‘vÃ­tÃ©sek

```sql
-- LojalitÃ¡s mÃ©rfÃ¶ldkÃ¶vek tÃ¡blÃ¡ja
CREATE TABLE loyalty_milestones (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL REFERENCES profiles(id),
  venue_id UUID NOT NULL REFERENCES venues(id),
  milestone_type TEXT NOT NULL, -- 'weekly_vip', 'monthly_vip', 'platinum', etc.
  achieved_at TIMESTAMPTZ NOT NULL DEFAULT now(),
  visit_count INTEGER NOT NULL,
  total_spend INTEGER, -- Ft
  reward_sent BOOLEAN DEFAULT false,
  reward_type TEXT,
  reward_sent_at TIMESTAMPTZ,
  admin_notified BOOLEAN DEFAULT false,
  created_at TIMESTAMPTZ DEFAULT now()
);

-- Index a gyors lekÃ©rdezÃ©shez
CREATE INDEX idx_loyalty_milestones_user_venue ON loyalty_milestones(user_id, venue_id);
CREATE INDEX idx_loyalty_milestones_pending ON loyalty_milestones(admin_notified, reward_sent);

-- Venue visit szÃ¡mlÃ¡lÃ³ nÃ©zet (materialized)
CREATE MATERIALIZED VIEW user_venue_visit_stats AS
SELECT 
  user_id,
  venue_id,
  COUNT(*) as total_visits,
  COUNT(*) FILTER (WHERE redeemed_at >= date_trunc('week', now())) as visits_this_week,
  COUNT(*) FILTER (WHERE redeemed_at >= date_trunc('month', now())) as visits_this_month,
  COUNT(*) FILTER (WHERE redeemed_at >= CURRENT_DATE) as visits_today,
  MAX(redeemed_at) as last_visit
FROM redemptions
WHERE status = 'success'
GROUP BY user_id, venue_id;

-- FrissÃ­tÃ©s trigger
CREATE INDEX idx_user_venue_visit_stats ON user_venue_visit_stats(user_id, venue_id);
```

### 5.2 Ãšj Edge Functions

| FunkciÃ³ | CÃ©l |
|---------|-----|
| `get-user-revenue-impact` | User bevÃ©tel attribÃºciÃ³ + ROI szÃ¡mÃ­tÃ¡s |
| `get-venue-loyalty-stats` | User venue-specifikus lojalitÃ¡s adatok |
| `detect-loyalty-milestones` | MÃ©rfÃ¶ldkÅ‘ detektÃ¡lÃ¡s (cron-bÃ³l hÃ­vhatÃ³) |
| `send-loyalty-reward` | Jutalom kÃ¼ldÃ©se + Ã©rtesÃ­tÃ©s |
| `get-pending-loyalty-alerts` | Admin Ã©rtesÃ­tÃ©sek listÃ¡ja |

### 5.3 Ãšj UI Komponensek

| Komponens | Hely |
|-----------|------|
| `UserRevenueImpact.tsx` | UserDetail - ÃttekintÃ©s tab |
| `VenueLoyaltyTracker.tsx` | UserDetail - HelyszÃ­nek tab (bÅ‘vÃ­tve) |
| `EnhancedRedemptionCard.tsx` | UserDetail - BevÃ¡ltÃ¡sok tab |
| `LoyaltyAlertsPanel.tsx` | Command Center / Dashboard |
| `SendLoyaltyRewardModal.tsx` | Modal jutalom kÃ¼ldÃ©shez |

### 5.4 API Flow

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BEVÃLTÃS TÃ–RTÃ‰NIK                                               â”‚
â”‚  (consume-redemption-token)                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. Redemption mentÃ©se                                           â”‚
â”‚  2. Visit counter frissÃ­tÃ©se (materialized view refresh)         â”‚
â”‚  3. MÃ©rfÃ¶ldkÅ‘ ellenÅ‘rzÃ©s:                                        â”‚
â”‚     - visits_this_week >= 5 â†’ "Heti VIP" mÃ©rfÃ¶ldkÅ‘              â”‚
â”‚     - visits_this_month >= 10 â†’ "Havi VIP" mÃ©rfÃ¶ldkÅ‘            â”‚
â”‚     - total_visits == 50 â†’ "Platina" mÃ©rfÃ¶ldkÅ‘                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼ (ha mÃ©rfÃ¶ldkÅ‘ elÃ©rve)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  loyalty_milestones tÃ¡blÃ¡ba mentÃ©s                               â”‚
â”‚  + admin_notified = false                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Command Center polling â†’ "Ãšj mÃ©rfÃ¶ldkÅ‘!" alert megjelenik      â”‚
â”‚  Admin kattint â†’ Modal megnyÃ­lik â†’ Jutalom kivÃ¡lasztÃ¡sa          â”‚
â”‚  â†’ Push Ã©rtesÃ­tÃ©s + reward_sent = true                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. ImplementÃ¡ciÃ³s PrioritÃ¡s

| PrioritÃ¡s | FunkciÃ³ | KomplexitÃ¡s |
|-----------|---------|-------------|
| **P0** | User Revenue Impact kÃ¡rtya | KÃ¶zepes |
| **P0** | Venue visit counters (heti/havi/Ã¶sszes) | Alacsony |
| **P0** | Loyalty milestone detection | KÃ¶zepes |
| **P1** | Admin alerts panel | KÃ¶zepes |
| **P1** | Send reward modal | KÃ¶zepes |
| **P1** | Enhanced redemption card (with POS data) | Magas |
| **P2** | Materialized view + auto-refresh | KÃ¶zepes |
| **P2** | Cron-based milestone detection | KÃ¶zepes |

---

## 7. ElÅ‘nyÃ¶k Ã–sszefoglalÃ¡sa

| FunkciÃ³ | Venue Ã‰rtÃ©k | Admin Ã‰rtÃ©k |
|---------|-------------|-------------|
| Revenue Impact | LÃ¡tja mennyit generÃ¡l a user | ROI tracking |
| Visit Counters | TÃ¶rzsvendÃ©g azonosÃ­tÃ¡s | VIP program |
| Loyalty Alerts | Automatikus Ã©rtesÃ­tÃ©s | ProaktÃ­v jutalom |
| Enhanced Redemption | KÃ¶ltÃ©s kontextus | Teljes kÃ©p |
| Milestone System | LojalitÃ¡s gamifikÃ¡ciÃ³ | Engagement boost |

---

## 8. User Experience JavÃ­tÃ¡sok

1. **Scorecard bÅ‘vÃ­tÃ©se**: ROI metrika hozzÃ¡adÃ¡sa
2. **Venue Affinity bÅ‘vÃ­tÃ©se**: Visit counters lÃ¡thatÃ³an (heti/havi badge-ek)
3. **BevÃ¡ltÃ¡sok tab**: Redemption + POS adat egyÃ¼tt
4. **Command Center**: Loyalty Alerts szekciÃ³
5. **Quick Actions**: "Jutalom kÃ¼ldÃ©se" gombok mindenhol

Ez a rendszer **lÃ¡thatÃ³vÃ¡ teszi az Ã©rtÃ©ket** amit minden felhasznÃ¡lÃ³ generÃ¡l, Ã©s **proaktÃ­v eszkÃ¶zÃ¶ket** ad az adminnak a lojalitÃ¡s jutalmazÃ¡sÃ¡ra.
